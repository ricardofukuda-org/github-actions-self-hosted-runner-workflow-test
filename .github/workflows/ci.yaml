name: CI pipeline
on:
#  push:
#    branches:
#      - master
  workflow_dispatch:
  pull_request:
    types: [ opened, synchronize ]
    branches:
      - master
      - develop
      - homolog
jobs:
  run-tests:
    runs-on: github-arc-runner-set
    env:
      DOCKER_REPOSITORY: "app"
      DOCKER_TAG: "${{ github.sha }}" # Use Git SHA as image tag
    steps:
    - name: Checkout sourcecode
      uses: actions/checkout@v4
    - name: Build image
      run: docker build -t ${{ env.DOCKER_REPOSITORY}}:${{ env.DOCKER_TAG }} .
    - name: Run tests
      run: docker run --rm ${{ env.DOCKER_REPOSITORY}}:${{ env.DOCKER_TAG }} npm test
      shell: bash
